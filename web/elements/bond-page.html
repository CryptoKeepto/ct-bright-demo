
<link rel="import" href="../../bower_components/coral-header/coral-header.html">
<link rel="import" href="../../bower_components/coral-icon/coral-icon.html">
<link rel="import" href="../../bower_components/coral-button/coral-button.html">


<link rel="import" href="realtime-data.html">
<link rel="import" href="bond-table.html">

<dom-module id="bond-page">
<template>
  <style>
    :host {
      display: block;
    }
   
  </style>

  <bond-table
    content="[[bonds]]">
  </bond-table>

    <realtime-data
      rics="[[_computeRics(bonds)]]"
      fields="[[bondFields]]"></realtime-data>

</template>
<script>

  (function() {

    Polymer({
      is: 'bond-page',
      properties: {

      },
      listeners: {
           'realtime-data-update': '_onBondsDataUpdate',
      },

      ready: function() {
        

        this.bonds = [
                    {ric:'TH1YT=RR', display:'1Y'},
                    {ric:'TH2YT=RR', display:'2Y'},
                    {ric:'TH3YT=RR', display:'3Y'},
                    {ric:'TH5YT=RR', display:'5Y'},
                    {ric:'TH7YT=RR', display:'7Y'},
                    {ric:'TH10YT=RR', display:'10Y'},
                    {ric:'TH14YT=RR', display:'14Y'},
                    {ric:'TH16YT=RR', display:'16Y'},
                    {ric:'TH20YT=RR', display:'20Y'},
                ];

        
              this.bondFields = [
                  'CF_LAST',
                  'CF_CLOSE'
              ];
      },

      startSubscription: function() {
        var elements = Polymer.dom(this.root).querySelectorAll('realtime-data');

        for (var index = 0; index < elements.length; index++) {
          var item = elements[index];

          item.startSubscription(index);
          
        }
      },

      stopSubscription: function() {
        var elements = Polymer.dom(this.root).querySelectorAll('realtime-data');

        for (var index = 0; index < elements.length; index++) {
          var item = elements[index];

          item.stopSubscription(index);
          
        }
      },

      _computeRics: function(indices) {
        var rics = [];

        for (var index = 0; index < indices.length; index++) {
          rics.push(indices[index].ric);
          
        }

        return rics;
      },

      _onBondsDataUpdate: function(e) {
        var realtime = e.detail.value;

        var el = Polymer.dom(this.root).querySelector('bond-table');

        if (el) {
          var data = realtime.data;

        for (var key in data) {
          if (data.hasOwnProperty(key)) {
            switch(key) {
                case 'CF_LAST':
                    //el.lastPrice = data[key].formatted;
                    el.addData(data[key].formatted, realtime.ric, 'lastPrice');
                    break;
                case 'CF_CLOSE':
                    //el.histClose = data[key].formatted;
                    el.addData(data[key].formatted, realtime.ric, 'closePrice');
                    break;
                default:
                    
            }
          }
        }
        }
      }
      
    });

  })();
</script>
</dom-module>
